
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GS Fashion - Admin Panel</title>
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
    :root {
      --primary: #6f42c1;
      --primary-light: #f0e6ff;
      --primary: #2c3e50;
      --secondary: #6c757d;
      --success: #198754;
      --danger: #dc3545;
      --light: #f8f9fa;
      --dark: #212529;
      --sidebar-width: 250px;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      overflow-x: hidden;
    }
    
    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: var(--sidebar-width);
      height: 100vh;
      background: var(--primary);
      color: white;
      z-index: 1000;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      padding-top: 1rem;
    }
    
    .sidebar-brand {
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      text-decoration: none;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 1rem;
      color: white;
      font-size: 1.25rem;
      font-weight: 600;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 1rem;
    }
    
    .sidebar-brand i {
      margin-right: 10px;
      font-size: 1.5rem;
      color: var(--primary-light);
    }
    
    .nav-link {
      color: rgba(255, 255, 255, 0.7);
      padding: 0.75rem 1.5rem;
      margin: 0.25rem 1rem;
      border-radius: 8px;
      transition: all 0.3s;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    
    .nav-link i {
      width: 24px;
      margin-right: 12px;
      text-align: center;
      font-size: 1.1rem;
    }
    
    .nav-link:hover, .nav-link.active {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      transform: translateX(5px);
    }
    
    .nav-link.active {
      background-color: var(--primary);
      color: white;
    }
    
    /* Main Content */
    .main-content {
      margin-left: var(--sidebar-width);
      padding: 2rem;
      min-height: 100vh;
      transition: all 0.3s;
    }
    
    /* Header */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid #e9ecef;
    }
    
    .page-title h1 {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--dark);
      margin: 0;
    }
    
    .page-title p {
      color: var(--secondary);
      margin: 0.25rem 0 0;
      font-size: 0.9rem;
    }
    
    /* Cards */
    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
      margin-bottom: 1.5rem;
      transition: transform 0.3s, box-shadow 0.3s;
      overflow: hidden;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    }
    
    .card-header {
      background-color: white;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      padding: 1.25rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
      color: var(--dark);
    }
    
    /* Buttons */
    .btn {
      padding: 0.5rem 1.25rem;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn i {
      margin-right: 8px;
    }
    
    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    
    .btn-primary:hover {
      background-color: #5a32a3;
      border-color: #5a32a3;
      transform: translateY(-2px);
    }
    
    .btn-outline-primary {
      color: var(--primary);
      border-color: var(--primary);
    }
    
    .btn-outline-primary:hover {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    
    /* Tables */
    .table {
      margin-bottom: 0;
    }
    
    .table thead th {
      background-color: #f8f9fa;
      color: #6c757d;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.5px;
      border-bottom-width: 1px;
      padding: 1rem 1.5rem;
      white-space: nowrap;
    }
    
    .table tbody td {
      padding: 1.25rem 1.5rem;
      vertical-align: middle;
      border-color: #f1f3f6;
    }
    
    .table-hover tbody tr:hover {
      background-color: rgba(111, 66, 193, 0.03);
    }
    
    /* Badges */
    .badge {
      font-weight: 500;
      padding: 0.4em 0.8em;
      border-radius: 50px;
      font-size: 0.75rem;
      text-transform: capitalize;
    }
    
    .badge.bg-success {
      background-color: rgba(25, 135, 84, 0.1) !important;
      color: #198754;
    }
    
    .badge.bg-warning {
      background-color: rgba(255, 193, 7, 0.1) !important;
      color: #ffc107;
    }
    
    .badge.bg-danger {
      background-color: rgba(220, 53, 69, 0.1) !important;
      color: #dc3545;
    }
    
    /* Stats Cards */
    .stat-card {
      border-left: 4px solid var(--primary);
      transition: all 0.3s;
      height: 100%;
    }
    
    .stat-card .card-body {
      padding: 1.5rem;
    }
    
    .stat-card .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      margin: 0.5rem 0;
      color: var(--dark);
    }
    
    .stat-card .stat-label {
      color: #6c757d;
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
    }
    
    .stat-card .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-left: auto;
      color: white;
    }
    
    .stat-card.primary .stat-icon {
      background-color: var(--primary);
    }
    
    .stat-card.success .stat-icon {
      background-color: var(--success);
    }
    
    .stat-card.warning .stat-icon {
      background-color: var(--warning);
    }
    
    .stat-card.info .stat-icon {
      background-color: #0dcaf0;
    }
    
    /* Search Box */
    .search-box {
      position: relative;
      max-width: 300px;
    }
    
    .search-box .form-control {
      padding-left: 2.5rem;
      border-radius: 8px;
      border: 1px solid #e1e5eb;
      background-color: #f8f9fa;
      transition: all 0.3s;
    }
    
    .search-box .form-control:focus {
      background-color: white;
      box-shadow: 0 0 0 0.2rem rgba(111, 66, 193, 0.1);
      border-color: #b4bdd3;
    }
    
    .search-box i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #6c757d;
    }
    
    /* Product Image */
    .product-img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #eee;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.show {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .search-box {
        margin-top: 1rem;
        max-width: 100%;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Mobile Toggle Button -->
  <button class="btn btn-primary d-md-none position-fixed" style="bottom: 1.5rem; right: 1.5rem; z-index: 1000; width: 50px; height: 50px; border-radius: 50%;" onclick="document.querySelector('.sidebar').classList.toggle('show')">
    <i class="fas fa-bars"></i>
  </button>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-2 px-0 sidebar">
        <div class="d-flex flex-column h-100 p-0">
          <!-- Brand -->
          <a href="/" class="sidebar-brand">
            <i class="fas fa-tshirt"></i>
            <span>GS Fashion</span>
          </a>
          
          <!-- Navigation -->
          <div class="flex-grow-1 overflow-auto">
            <ul class="nav flex-column mb-auto px-2">
              <li class="nav-item">
                <a href="#" class="nav-link active">
                  <i class="fas fa-box"></i>
                  Products
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="fas fa-tags"></i>
                  Categories
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="fas fa-shopping-cart"></i>
                  Orders
                  <span class="badge bg-danger rounded-pill ms-auto">3</span>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="fas fa-chart-line"></i>
                  Analytics
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="fas fa-users"></i>
                  Customers
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="fas fa-cog"></i>
                  Settings
                </a>
              </li>
            </ul>
          </div>
          
          <!-- User Profile -->
          <div class="p-3 border-top border-secondary">
            <div class="dropdown">
              <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="https://ui-avatars.com/api/?name=Admin&background=6f42c1&color=fff" alt="Admin" width="40" height="40" class="rounded-circle me-2">
                <div>
                  <div class="fw-bold">Admin</div>
                  <small>Administrator</small>
                </div>
              </a>
              <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdownUser">
                <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2"></i>Sign out</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- Main Content -->
      <div class="col-md-10 main-content" id="adminPanel">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">Product Management</h2>
          <button class="btn btn-primary" onclick="adminPanel.showAddForm()">
            <i class="fas fa-plus me-2"></i>Add Product
          </button>
        </div>
        <!-- Stats Cards -->
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Total Products</h6>
                    <h3 class="mb-0" id="totalProducts">0</h3>
                  </div>
                  <div class="bg-primary bg-opacity-10 p-3 rounded">
                    <i class="fas fa-box text-primary"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">In Stock</h6>
                    <h3 class="mb-0" id="inStockCount">0</h3>
                  </div>
                  <div class="bg-success bg-opacity-10 p-3 rounded">
                    <i class="fas fa-check-circle text-success"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Out of Stock</h6>
                    <h3 class="mb-0" id="outOfStockCount">0</h3>
                  </div>
                  <div class="bg-danger bg-opacity-10 p-3 rounded">
                    <i class="fas fa-times-circle text-danger"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Categories</h6>
                    <h3 class="mb-0">3</h3>
                  </div>
                  <div class="bg-info bg-opacity-10 p-3 rounded">
                    <i class="fas fa-tags text-info"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Products Table -->
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">Products</h5>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead>
                  <tr>
                    <th style="width: 50px;">#</th>
                    <th>Product</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Last Updated</th>
                    <th class="text-end" style="width: 150px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="productList">
                  <tr>
                    <td colspan="7" class="text-center py-5">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                      <p class="mt-2 mb-0">Loading products...</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-footer bg-white d-flex justify-content-between align-items-center">
            <div class="text-muted small">
              Showing <span id="showingFrom">1</span> to <span id="showingTo">10</span> of <span id="totalItems">0</span> entries
            </div>
            <nav>
              <ul class="pagination pagination-sm mb-0">
                <li class="page-item disabled">
                  <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                  <a class="page-link" href="#">Next</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Add Product Modal -->
  <div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addProductForm" onsubmit="adminPanel.handleFormSubmit(event)">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Product Name</label>
                  <input type="text" class="form-control" name="name" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Category</label>
                  <select class="form-select" name="category" required>
                    <option value="">Select Category</option>
                    <option value="kurti">Kurti</option>
                    <option value="tunic">Tunic</option>
                    <option value="top">Top</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Material</label>
                  <input type="text" class="form-control" name="material" placeholder="e.g., Cotton, Silk, etc." required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Price (₹)</label>
                  <div class="input-group">
                    <span class="input-group-text">₹</span>
                    <input type="number" class="form-control" name="price" min="0" step="0.01" required>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Product Image</label>
                  <input type="file" class="form-control" name="image" accept="image/*">
                  <small class="text-muted">Upload a high-quality image (800x1000px recommended)</small>
                </div>
                <div class="mb-3">
                  <label class="form-label">Available Sizes</label>
                  <div class="d-flex gap-3">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="S" id="sizeS" name="sizes[]">
                      <label class="form-check-label" for="sizeS">S</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="M" id="sizeM" name="sizes[]" checked>
                      <label class="form-check-label" for="sizeM">M</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="L" id="sizeL" name="sizes[]">
                      <label class="form-check-label" for="sizeL">L</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="XL" id="sizeXL" name="sizes[]">
                      <label class="form-check-label" for="sizeXL">XL</label>
                    </div>
                  </div>
                </div>
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" id="inStock" name="in_stock" checked>
                  <label class="form-check-label" for="inStock">In Stock</label>
                </div>
              </div>
              <div class="col-12">
                <div class="mb-3">
                  <label class="form-label">Description</label>
                  <textarea class="form-control" name="description" rows="3" placeholder="Enter product description..."></textarea>
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-end gap-2">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">
                <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                Add Product
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- Toast Notifications -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="toast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>
  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
  <script src="js/admin-simple.js"></script>
  
  <script>
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Initialize popovers
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl);
    });
    
    // Initialize toast
    var toastEl = document.getElementById('toast');
    var toast = new bootstrap.Toast(toastEl, { autohide: true, delay: 3000 });
    
    // Admin Panel JavaScript
    const adminPanel = {
      products: [],
      currentProduct: null,
      
      // Initialize the admin panel
      init: function() {
        this.loadProducts();
        this.setupEventListeners();
      },
      
      // Load products from the server
      loadProducts: async function() {
        try {
          const response = await fetch('http://localhost:5000/products');
          this.products = await response.json();
          this.renderProductList();
          this.updateStats();
        } catch (error) {
          console.error('Error loading products:', error);
          this.showNotification('Error loading products', 'error');
        }
      },
      
      // Render the product list
      renderProductList: function() {
        const productList = document.getElementById('productList');
        if (!productList) return;
        
        if (this.products.length === 0) {
          productList.innerHTML = `
            <tr>
              <td colspan="7" class="text-center py-5">
                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                <p class="mb-0">No products found</p>
                <button class="btn btn-primary mt-3" onclick="adminPanel.showAddForm()">
                  <i class="fas fa-plus me-2"></i>Add Your First Product
                </button>
              </td>
            </tr>`;
          return;
        }
        
        productList.innerHTML = this.products.map((product, index) => `
          <tr>
            <td>${index + 1}</td>
            <td>
              <div class="d-flex align-items-center">
                <img src="http://192.168.1.5:5000/images/${product.image || 'placeholder.svg'}" alt="${product.name}" class="product-img me-3" onerror="this.src='http://192.168.1.5:5000/images/placeholder.svg'">
                <div>
                  <div class="fw-bold">${product.name}</div>
                  <small class="text-muted">ID: ${product.id}</small>
                </div>
              </div>
            </td>
            <td>
              <span class="badge bg-light text-dark text-capitalize">${product.category}</span>
            </td>
            <td>₹${parseFloat(product.price || 0).toFixed(2)}</td>
            <td>
              ${product.in_stock 
                ? '<span class="badge bg-success">In Stock</span>' 
                : '<span class="badge bg-danger">Out of Stock</span>'}
            </td>
            <td>${new Date().toLocaleDateString()}</td>
            <td class="text-end">
              <button class="btn btn-sm btn-outline-primary me-1" onclick="adminPanel.editProduct(${product.id})" data-bs-toggle="tooltip" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="adminPanel.confirmDelete(${product.id})" data-bs-toggle="tooltip" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>`).join('');
          
        // Re-initialize tooltips
        tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl);
        });
      },
      
      // Update statistics
      updateStats: function() {
        const totalProducts = this.products.length;
        const inStockCount = this.products.filter(p => p.in_stock).length;
        const outOfStockCount = totalProducts - inStockCount;
        
        document.getElementById('totalProducts').textContent = totalProducts;
        document.getElementById('inStockCount').textContent = inStockCount;
        document.getElementById('outOfStockCount').textContent = outOfStockCount;
        document.getElementById('showingTo').textContent = Math.min(10, totalProducts);
        document.getElementById('totalItems').textContent = totalProducts;
      },
      
      // Show add product form
      showAddForm: function() {
        this.currentProduct = null;
        const modal = new bootstrap.Modal(document.getElementById('addProductModal'));
        const form = document.getElementById('addProductForm');
        form.reset();
        form.querySelector('input[name="name"]').focus();
        modal.show();
      },
      
      // Add a new product
      addProduct: async function(e) {
        e.preventDefault();
        const form = e.target;
        const submitBtn = form.querySelector('button[type="submit"]');
        const spinner = submitBtn.querySelector('.spinner-border');
        
        try {
          // Show loading state
          submitBtn.disabled = true;
          spinner.classList.remove('d-none');
          
          // Get form data
          const formData = new FormData(form);
          const product = {
            name: formData.get('name'),
            category: formData.get('category'),
            price: parseFloat(formData.get('price')) || 0,
            sizes: Array.from(formData.getAll('sizes[]')).join(','),
            in_stock: formData.get('in_stock') === 'on',
            description: formData.get('description'),
            image: formData.get('image')?.name || ''
          };
          
          // In a real app, you would upload the image and save the product to the server
          // For now, we'll just add it to the local array
          const newProduct = {
            ...product,
            id: Date.now(),
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
          };
          
          this.products.unshift(newProduct);
          this.renderProductList();
          this.updateStats();
          
          // Close modal and show success message
          bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
          this.showNotification('Product added successfully', 'success');
          
        } catch (error) {
          console.error('Error adding product:', error);
          this.showNotification('Error adding product', 'error');
        } finally {
          submitBtn.disabled = false;
          spinner.classList.add('d-none');
        }
      },
      
      // Edit a product
      editProduct: function(id) {
        this.currentProduct = this.products.find(p => p.id === id);
        if (!this.currentProduct) return;
        
        const modal = new bootstrap.Modal(document.getElementById('addProductModal'));
        const form = document.getElementById('addProductForm');
        
        // Fill form with product data
        form.querySelector('input[name="name"]').value = this.currentProduct.name;
        form.querySelector('select[name="category"]').value = this.currentProduct.category;
        form.querySelector('input[name="price"]').value = this.currentProduct.price;
        form.querySelector('input[name="in_stock"]').checked = this.currentProduct.in_stock;
        form.querySelector('textarea[name="description"]').value = this.currentProduct.description || '';
        
        // Check sizes
        if (this.currentProduct.sizes) {
          const sizes = this.currentProduct.sizes.split(',');
          sizes.forEach(size => {
            const checkbox = form.querySelector(`input[value="${size}"]`);
            if (checkbox) checkbox.checked = true;
          });
        }
        
        // Change modal title and submit button text
        modal._element.querySelector('.modal-title').textContent = 'Edit Product';
        form.querySelector('button[type="submit"]').innerHTML = `
          <span class="spinner-border spinner-border-sm d-none" role="status"></span>
          Update Product`;
        
        modal.show();
      },
      
      // Confirm before deleting a product
      confirmDelete: function(id) {
        this.currentProduct = this.products.find(p => p.id === id);
        if (!this.currentProduct) return;
        
        const modal = new bootstrap.Modal(document.getElementById('deleteProductModal'));
        modal.show();
      },
      
      // Delete a product
      deleteProduct: async function() {
        if (!this.currentProduct) return;
        
        try {
          // In a real app, you would make an API call to delete the product
          // For now, we'll just remove it from the local array
          this.products = this.products.filter(p => p.id !== this.currentProduct.id);
          this.renderProductList();
          this.updateStats();
          
          // Close modal and show success message
          bootstrap.Modal.getInstance(document.getElementById('deleteProductModal')).hide();
          this.showNotification('Product deleted successfully', 'success');
          
        } catch (error) {
          console.error('Error deleting product:', error);
          this.showNotification('Error deleting product', 'error');
        }
      },
      
      // Show notification toast
      showNotification: function(message, type = 'info') {
        const toast = document.getElementById('toast');
        const toastBody = toast.querySelector('.toast-body');
        
        // Set message and style based on type
        toastBody.textContent = message;
        
        // Remove all type classes and add the new one
        ['bg-primary', 'bg-success', 'bg-danger', 'bg-warning', 'bg-info'].forEach(cls => {
          toast.classList.remove(cls);
        });
        
        switch(type) {
          case 'success':
            toast.classList.add('bg-success');
            break;
          case 'error':
            toast.classList.add('bg-danger');
            break;
          case 'warning':
            toast.classList.add('bg-warning');
            break;
          case 'info':
          default:
            toast.classList.add('bg-primary');
        }
        
        // Show the toast
        const bsToast = new bootstrap.Toast(toast, { autohide: true, delay: 3000 });
        bsToast.show();
      },
      
      // Set up event listeners
      setupEventListeners: function() {
        // Add product form submission
        const addProductForm = document.getElementById('addProductForm');
        if (addProductForm) {
          addProductForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (this.currentProduct) {
              this.updateProduct(e);
            } else {
              this.addProduct(e);
            }
          });
        }
        
        // Delete confirmation
        const deleteBtn = document.querySelector('#deleteProductModal .btn-danger');
        if (deleteBtn) {
          deleteBtn.addEventListener('click', () => this.deleteProduct());
        }
      },
      
      // Update a product
      updateProduct: async function(e) {
        e.preventDefault();
        if (!this.currentProduct) return;
        
        const form = e.target;
        const submitBtn = form.querySelector('button[type="submit"]');
        const spinner = submitBtn.querySelector('.spinner-border');
        
        try {
          // Show loading state
          submitBtn.disabled = true;
          spinner.classList.remove('d-none');
          
          // Get form data
          const formData = new FormData(form);
          const updatedProduct = {
            ...this.currentProduct,
            name: formData.get('name'),
            category: formData.get('category'),
            price: parseFloat(formData.get('price')) || 0,
            sizes: Array.from(formData.getAll('sizes[]')).join(','),
            in_stock: formData.get('in_stock') === 'on',
            description: formData.get('description'),
            updated_at: new Date().toISOString()
          };
          
          // Handle image upload if a new image was selected
          const imageFile = formData.get('image');
          if (imageFile && imageFile.name) {
            updatedProduct.image = imageFile.name;
            // In a real app, you would upload the image file here
          }
          
          // In a real app, you would make an API call to update the product
          // For now, we'll just update it in the local array
          const index = this.products.findIndex(p => p.id === this.currentProduct.id);
          if (index !== -1) {
            this.products[index] = updatedProduct;
            this.renderProductList();
          }
          
          // Close modal and show success message
          bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
          this.showNotification('Product updated successfully', 'success');
          
        } catch (error) {
          console.error('Error updating product:', error);
          this.showNotification('Error updating product', 'error');
        } finally {
          submitBtn.disabled = false;
          spinner.classList.add('d-none');
        }
      }
    };
    
    // Initialize the admin panel when the DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      adminPanel.init();
    });
  </script>
</body>
</html>
